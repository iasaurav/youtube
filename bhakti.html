<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Grid Playlist</title>

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:Arial,sans-serif;
  padding:15px;
}

input{
  width:100%;
  padding:8px;
  margin-bottom:15px;
  background:#111;
  color:#fff;
  border:1px solid #333;
}

#grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:12px;
}

.card{
  cursor:pointer;
  background:#111;
  border-radius:6px;
  overflow:hidden;
  border:2px solid transparent;
  transition:.2s;
}

.card:hover{background:#1a1a1a;}

.card.active{
  border-color:#2563eb;
  background:#1e293b;
}

.thumb{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.title{
  padding:6px 8px;
  font-size:13px;
}

#player{
  max-width:900px;
  margin-top:15px;
}
</style>
</head>

<body>

<h2>YouTube Grid Playlist</h2>

<input id="search" placeholder="Search video..." />
<div id="grid"></div>
<div id="player"></div>

<script>
const link =
"https://docs.google.com/spreadsheets/d/1nMOSo-1YmviPyhOo_Vw9dx9v4cPqRpXdHeEcaBiS2H4/gviz/tq?tqx=out:json&gid=1896219080";

let videos=[];
let player;
let currentIndex=0;

// Load YouTube API
const tag=document.createElement("script");
tag.src="https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

// Fetch Sheet
fetch(link)
.then(r=>r.text())
.then(t=>{
  const json=JSON.parse(t.substring(47).slice(0,-2));
  videos=json.table.rows.map(r=>({
    id:r.c[0]?.v,
    title:r.c[1]?.v
  }));
  renderGrid(videos);
});

// Render grid
function renderGrid(data){
  const grid=document.getElementById("grid");
  grid.innerHTML="";

  data.forEach(v=>{
    const index=videos.indexOf(v);

    const card=document.createElement("div");
    card.className="card";
    card.dataset.id=v.id;

    card.onclick=()=>{
      playFrom(index);
      document.getElementById("player").scrollIntoView({
        behavior:"smooth"
      });
    };

    card.innerHTML=`
      <img class="thumb" src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg">
      <div class="title">${v.title}</div>
    `;

    grid.appendChild(card);
  });
}

// Search
document.getElementById("search").addEventListener("input",e=>{
  const q=e.target.value.toLowerCase();
  renderGrid(
    videos.filter(v=>v.title.toLowerCase().includes(q))
  );
});

// Play from clicked index
function playFrom(index){
  currentIndex=index;
  loadPlayer();
}

// Create or update player
function loadPlayer(){

  if(!player){
    player=new YT.Player("player",{
      host:"https://www.youtube-nocookie.com",
      width:"100%",
      height:"500",
      videoId:videos[currentIndex].id,
      playerVars:{
        autoplay:1,
        rel:0,
        modestbranding:1,
vq:"tiny"

      },
      events:{
        onStateChange:onStateChange
      }
    });
  }else{
    player.loadVideoById(videos[currentIndex].id);
  }

  highlight(videos[currentIndex].id);
}

// Highlight active card
function highlight(id){
  document.querySelectorAll(".card").forEach(c=>{
    c.classList.toggle("active",c.dataset.id===id);
  });
}

// Auto play next (infinite)
function playNext(){

  currentIndex++;

  if(currentIndex>=videos.length){
    currentIndex=0; // loop playlist
  }

  loadPlayer();
}

// Player events
function onStateChange(e){

  if(e.data===YT.PlayerState.PLAYING){
    highlight(player.getVideoData().video_id);
  }

  if(e.data===YT.PlayerState.ENDED){
    playNext(); // ‚≠ê auto next infinite
  }
}
</script>

</body>
</html>
